/*
NYC Evictions Data Exploration 
*/

--DATA CLEANING

--Search for null or empty values in columns critical for analysis

SELECT *
FROM `nyc-eviction-data.NYC_evictions_downloaded_20240102.NYC_evictions`
WHERE
  Executed_Date IS null
  OR
  Eviction_Postcode IS null
  OR
  Residential_Commercial IS null or TRIM(Residential_Commercial) = ''
  OR
  BOROUGH IS null OR TRIM(BOROUGH) = '';


--Search for duplicates in Eviction Address column

SELECT 
  Eviction_Address,
  COUNT (Eviction_Address)
FROM `nyc-eviction-data.NYC_evictions_downloaded_20240102.NYC_evictions`
GROUP BY
  Eviction_Address
HAVING COUNT (Executed_Date) >1;


--Search for duplicates in Court Index Number column and determine if the column can be used as unique identifier in dataset via query to determine if more than one address is associated with each Court Index Number

SELECT 
Court_Index_Number, COUNT(DISTINCT Eviction_Address ) AS distinct_address_count
FROM `nyc-eviction-data.NYC_evictions_downloaded_20240102.NYC_evictions` 
GROUP BY
  Court_Index_Number
HAVING
  COUNT(DISTINCT Eviction_Address) > 1;


--Determine if Execution Date can be used as a unique identifier in the dataset via query to determine if more than one address is associated with each Execution Date

SELECT 
Executed_Date, COUNT(DISTINCT Eviction_Address ) AS distinct_address_count
FROM `nyc-eviction-data.NYC_evictions_downloaded_20240102.NYC_evictions` 
GROUP BY
  Executed_Date
HAVING
  COUNT(DISTINCT Eviction_Address) > 1;


--DATA PROCESSING

-- Create a temporary table with distinct court index numbers, addresses, executed dates, and boroughs to query dataset without duplicate entries or filings for a single, distinct residential eviction

CREATE TEMP TABLE temp_unique_evictions AS
SELECT
  DISTINCT Court_Index_Number,
  Eviction_Address,
  Executed_Date,
  Borough
FROM
  nyc-eviction-data.NYC_evictions_downloaded_20240102.NYC_evictions
WHERE
  Residential_Commercial = 'Residential';
